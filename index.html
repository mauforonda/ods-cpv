<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="generator" content="Observable Framework v1.13.3">
<title>ODS CPV | Indicadores de desarrollo basados en el Censo 2024</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,opsz,wght@0,8..60,200..900;1,8..60,200..900&amp;display=swap" crossorigin>
<link rel="preload" as="style" href="./_observablehq/theme-air,near-midnight,alt,wide.db1cdf55.css">
<link rel="preload" as="style" href="./_observablehq/stdlib/inputs.ea9fd553.css">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,opsz,wght@0,8..60,200..900;1,8..60,200..900&amp;display=swap" crossorigin>
<link rel="stylesheet" type="text/css" href="./_observablehq/theme-air,near-midnight,alt,wide.db1cdf55.css">
<link rel="stylesheet" type="text/css" href="./_observablehq/stdlib/inputs.ea9fd553.css">
<link rel="modulepreload" href="./_observablehq/client.ce20a9f1.js">
<link rel="modulepreload" href="./_observablehq/runtime.e080113b.js">
<link rel="modulepreload" href="./_observablehq/stdlib.73a8ec5a.js">
<link rel="modulepreload" href="./_import/components/indicadores.2ddb25d8.js">
<link rel="modulepreload" href="./_npm/d3@7.9.0/e780feca.js">
<link rel="modulepreload" href="./_npm/htl@0.3.1/72f4716c.js">
<link rel="modulepreload" href="./_observablehq/stdlib/inputs.4ef1d259.js">
<link rel="modulepreload" href="./_npm/@observablehq/plot@0.6.17/d761ef9b.js">
<link rel="modulepreload" href="./_npm/topojson-client@3.1.0/edd9ee95.js">
<link rel="modulepreload" href="./_npm/isoformat@0.2.1/18cbf477.js">
<link rel="modulepreload" href="./_npm/d3-array@3.2.4/e93ca09f.js">
<link rel="modulepreload" href="./_npm/d3-axis@3.0.0/0f2de24d.js">
<link rel="modulepreload" href="./_npm/d3-brush@3.0.0/65eb105b.js">
<link rel="modulepreload" href="./_npm/d3-chord@3.0.1/7ef8fb2e.js">
<link rel="modulepreload" href="./_npm/d3-color@3.1.0/aeb57b94.js">
<link rel="modulepreload" href="./_npm/d3-contour@4.0.2/1d2aed74.js">
<link rel="modulepreload" href="./_npm/d3-delaunay@6.0.4/5ced1d52.js">
<link rel="modulepreload" href="./_npm/d3-dispatch@3.0.1/9ba9c7f3.js">
<link rel="modulepreload" href="./_npm/d3-drag@3.0.0/4202580c.js">
<link rel="modulepreload" href="./_npm/d3-dsv@3.0.1/9cffc2bd.js">
<link rel="modulepreload" href="./_npm/d3-ease@3.0.1/cdd7e898.js">
<link rel="modulepreload" href="./_npm/d3-fetch@3.0.1/b4e2ad9a.js">
<link rel="modulepreload" href="./_npm/d3-force@3.0.0/5e804d15.js">
<link rel="modulepreload" href="./_npm/d3-format@3.1.0/86074ef6.js">
<link rel="modulepreload" href="./_npm/d3-geo@3.1.1/40599fb3.js">
<link rel="modulepreload" href="./_npm/d3-hierarchy@3.1.2/e49e792c.js">
<link rel="modulepreload" href="./_npm/d3-interpolate@3.0.1/8d1e5425.js">
<link rel="modulepreload" href="./_npm/d3-path@3.1.0/20d3f133.js">
<link rel="modulepreload" href="./_npm/d3-polygon@3.0.1/7553081f.js">
<link rel="modulepreload" href="./_npm/d3-quadtree@3.0.1/0dfd751c.js">
<link rel="modulepreload" href="./_npm/d3-random@3.0.1/3c90ee06.js">
<link rel="modulepreload" href="./_npm/d3-scale@4.0.2/843b6a76.js">
<link rel="modulepreload" href="./_npm/d3-scale-chromatic@3.1.0/ba24c2e7.js">
<link rel="modulepreload" href="./_npm/d3-selection@3.0.0/4d94e5b7.js">
<link rel="modulepreload" href="./_npm/d3-shape@3.2.0/6d3a6726.js">
<link rel="modulepreload" href="./_npm/d3-time@3.1.0/9f03c579.js">
<link rel="modulepreload" href="./_npm/d3-time-format@4.1.0/07c9626f.js">
<link rel="modulepreload" href="./_npm/d3-timer@3.0.1/b58a267d.js">
<link rel="modulepreload" href="./_npm/d3-transition@3.0.1/004da2ac.js">
<link rel="modulepreload" href="./_npm/d3-zoom@3.0.0/b5786b3f.js">
<link rel="modulepreload" href="./_npm/interval-tree-1d@1.0.4/53fe8176.js">
<link rel="modulepreload" href="./_npm/internmap@2.0.3/e08981d9.js">
<link rel="modulepreload" href="./_npm/delaunator@5.0.1/02d43215.js">
<link rel="modulepreload" href="./_npm/binary-search-bounds@2.0.5/cbf6ba23.js">
<link rel="modulepreload" href="./_npm/robust-predicates@3.0.2/aa00730b.js">
<link rel="icon" href="https://mauforonda.github.io/images/icon.svg" type="image/svg" sizes="32x32">
<script type="module">

import {define} from "./_observablehq/client.ce20a9f1.js";
import {registerFile} from "./_observablehq/stdlib.73a8ec5a.js";

registerFile("./municipios.json", {"name":"./municipios.json","mimeType":"application/json","path":"./_file/municipios.c9eb137b.json","lastModified":1764289548988,"size":184233});

define({id: "eecc0d5c", inputs: ["Generators"], outputs: ["dark"], body: (Generators) => {
const dark = Generators.dark();
return {dark};
}});

define({id: "cb634678", inputs: ["dark"], outputs: ["colors"], body: (dark) => {
const colors = {
  background: dark ? "#242323" : "#fbfbfb",
  mid: dark ? "#bdbdbdff" : "#aeaeaeff",
};
return {colors};
}});

define({id: "06b7a24d", inputs: ["d3","definiciones"], outputs: ["indicadores","raw","datos","bins"], body: async (d3,definiciones) => {
// Cargar datDatos de indicadoreos

// Definiciones de indicadores
const indicadores = await d3.json(
  "https://raw.githubusercontent.com/mauforonda/ods-cpv/refs/heads/main/indicadores.json"
);

const raw = await d3.csv(
  "https://raw.githubusercontent.com/mauforonda/ods-cpv/refs/heads/main/datos.csv",
  d3.autoType
);

// Valores de indicadores por municipio
const datos = (async () => {
  return raw.reduce((acc, obj) => {
    const munId = obj.id_municipio;

    if (!acc[munId]) {
      acc[munId] = {
        municipio: {
          departamento: obj.departamento,
          provincia: obj.provincia,
          municipio: obj.municipio,
        },
      };
    }

    ["2012", "2024"].forEach((year) => {
      if (obj[year] !== undefined) {
        if (!acc[munId][year]) acc[munId][year] = {};
        acc[munId][year][obj.indicador] = obj[year];
      }
    });

    if (obj["2024"] !== undefined && obj["2012"] !== undefined) {
      if (!acc[munId].diferencia) acc[munId].diferencia = {};
      acc[munId].diferencia[obj.indicador] = obj["2024"] - obj["2012"];
    }

    return acc;
  }, {});
})();

const bins = (() => {
  const byIndicador = d3.group(raw, (d) => d.indicador);
  const result = {};

  for (const [indicador, rows] of byIndicador) {
    const years = definiciones[indicador].baseline
      ? ["2012", "2024"]
      : ["2024"];
    const diffValues = rows.map((d) => ({
      value: +d["2024"] - +d["2012"],
      municipio: d.id_municipio,
    }));

    const estadoMap = rows.flatMap((d) => years.map((year) => +d[year]));
    const diffMap = diffValues.map((d) => d.value);

    const estadoBin = d3
      .bin()
      .domain(d3.extent(estadoMap))
      .thresholds(15)
      .value((d) => d.value);

    const diffBin = d3
      .bin()
      .domain(d3.extent(diffMap))
      .thresholds(15)
      .value((d) => d.value);

    result[indicador] = {};
    let maxCount = 0;

    for (const year of years) {
      const values = rows.map((d) => ({
        value: +d[year],
        municipio: d.id_municipio,
      }));
      const yearBins = estadoBin(values);

      const municipios = {};
      const binSummaries = yearBins.map((b) => {
        const binKey = `${b.x0}-${b.x1}`;
        municipios[binKey] = b.map((d) => d.municipio);
        maxCount = Math.max(maxCount, b.length);
        return {
          bin_value: binKey,
          x0: b.x0,
          x1: b.x1,
          mid: (b.x0 + b.x1) / 2,
          count: b.length,
        };
      });

      result[indicador][year] = {
        bins: binSummaries,
        municipios,
        extent: d3.extent(estadoMap),
      };
    }

    const diffBins = diffBin(diffValues);
    const diffMunicipios = {};
    const diffSummaries = diffBins.map((b) => {
      const binKey = `${b.x0}-${b.x1}`;
      diffMunicipios[binKey] = b.map((d) => d.municipio);
      maxCount = Math.max(maxCount, b.length);
      return {
        bin_value: binKey,
        x0: b.x0,
        x1: b.x1,
        mid: (b.x0 + b.x1) / 2,
        count: b.length,
      };
    });

    result[indicador]["diferencia"] = {
      bins: diffSummaries,
      municipios: diffMunicipios,
      extent: d3.extent(diffMap),
    };

    result[indicador].max_count = maxCount;
  }

  return result;
})();
return {indicadores,raw,datos,bins};
}});

define({id: "4fc3cdab", outputs: ["definiciones"], body: async () => {
const {definiciones} = await import("./_import/components/indicadores.2ddb25d8.js");

return {definiciones};
}});

define({id: "246b763d", inputs: ["FileAttachment","topojson","datos","d3"], outputs: ["features"], body: (FileAttachment,topojson,datos,d3) => {
// Geometrías de municipios
const features = (async () => {
  const topo = await FileAttachment("./municipios.json").json();
  const municipios = topojson.feature(topo, topo.objects.mun);
  const validos = Object.keys(datos).map((d) => Number(d));
  municipios.features.forEach((feature) => {
    feature.properties = {
      ...feature.properties,
      centroid: d3.geoCentroid(feature),
    };
    feature.id = Number(feature.properties.codigo);
  });
  municipios.features = municipios.features.filter((d) =>
    validos.includes(d.id)
  );
  return municipios;
})();
return {features};
}});

define({id: "04e18386", inputs: ["Inputs","indicadores","definiciones","Generators"], outputs: ["indicador_input","indicador"], body: (Inputs,indicadores,definiciones,Generators) => {
const indicador_input = Inputs.select(Object.keys(indicadores), {
  format: (d) => definiciones[d].abreviacion,
});
const indicador = Generators.input(indicador_input);
return {indicador_input,indicador};
}});

define({id: "20fa5508", inputs: ["definiciones","indicador"], outputs: ["definicion","anio"], body: (definiciones,indicador) => {
const definicion = definiciones[indicador];
const anio = 2024;
return {definicion,anio};
}});

define({id: "3930c542", inputs: ["Plot","colors","d3"], outputs: ["leyenda_lineal"], body: (Plot,colors,d3) => {
function leyenda_lineal(color_definicion, format) {
  return Plot.legend({
    opacity: 0.8,
    margin: 0,
    width: 240,
    style: {
      color: colors.mid,
    },
    color: {
      type: "linear",
      interpolate: "hcl",
      tickFormat: d3.format(format),
      ...color_definicion,
    },
  });
}
return {leyenda_lineal};
}});

define({id: "899678b8", inputs: ["datos","indicador","d3","definicion","htl"], outputs: ["municipio_seleccion"], body: (datos,indicador,d3,definicion,htl) => {
function municipio_seleccion(municipio, tipo) {
  if (municipio) {
    const valor = datos[municipio.id][tipo][indicador];
    const meta = datos[municipio.id].municipio;
    const format = d3.format(
      tipo == "diferencia" ? "+" : "" + definicion.format
    );
    return htl.html`<mensaje>
      <valor>${format(valor)}</valor>
      <unidad>${definicion.unidad}</unidad>
      <municipio><span>en </span>${meta.municipio}</municipio>
      <departamento>${meta.departamento}</departamento>
    </mensaje>`;
  } else {
    return htl.html`<mensaje></mensaje>`;
  }
}
return {municipio_seleccion};
}});

define({id: "8b6ac28a", inputs: ["Plot","features","datos","indicador","colors"], outputs: ["draw_mapa"], body: (Plot,features,datos,indicador,colors) => {
function draw_mapa(tipo, color_definicion) {
  const mapa = Plot.plot({
    marginTop: 30,
    marginBottom: 0,
    height: 500,
    width: 500,

    projection: {
      type: "mercator",
      domain: features,
    },
    color: {
      interpolate: "hcl",
      ...color_definicion,
    },

    marks: [
      Plot.geo(features.features, {
        fill: (d) => datos[d.id][tipo][indicador],
        fillOpacity: 0.8,
        // fillOpacity: (d) => (highlight[tipo].includes(d.id) ? 0.8 : 0.6),
        stroke: colors.background,
        strokeWidth: 0.4,
      }),

      Plot.geo(
        features.features,
        Plot.pointer(
          Plot.centroid({
            fill: (d) => datos[d.id][tipo][indicador],
            stroke: colors.background,
            strokeWidth: 2.5,
          })
        )
      ),
    ],
  });
  return mapa;
}
return {draw_mapa};
}});

define({id: "8d37328f", inputs: ["draw_mapa","definicion","Generators"], outputs: ["mapa_actual","municipio_actual"], body: (draw_mapa,definicion,Generators) => {
const mapa_actual = draw_mapa("2024", definicion.estado);
const municipio_actual = Generators.input(mapa_actual);
return {mapa_actual,municipio_actual};
}});

define({id: "443ad38c", inputs: ["binPlot","definicion","Generators"], outputs: ["binplot_actual","bin_actual"], body: (binPlot,definicion,Generators) => {
const binplot_actual = binPlot("2024", definicion.estado);
const bin_actual = Generators.input(binplot_actual);
return {binplot_actual,bin_actual};
}});

define({id: "154cd381", inputs: ["draw_mapa","definicion","Generators"], outputs: ["mapa_previo","municipio_previo"], body: (draw_mapa,definicion,Generators) => {
const mapa_previo = draw_mapa("2012", definicion.estado);
const municipio_previo = Generators.input(mapa_previo);
return {mapa_previo,municipio_previo};
}});

define({id: "d9f9a22c", inputs: ["definicion","binPlot","Generators"], outputs: ["binplot_previo","bin_previo"], body: (definicion,binPlot,Generators) => {
const binplot_previo = definicion.baseline
  ? binPlot("2012", definicion.estado)
  : null;
const bin_previo = Generators.input(binplot_previo);
return {binplot_previo,bin_previo};
}});

define({id: "e3283b37", inputs: ["draw_mapa","definicion","Generators"], outputs: ["mapa_diferencia","municipio_diferencia"], body: (draw_mapa,definicion,Generators) => {
const mapa_diferencia = draw_mapa("diferencia", definicion.diferencia);
const municipio_diferencia = Generators.input(mapa_diferencia);
return {mapa_diferencia,municipio_diferencia};
}});

define({id: "34d3a4f7", inputs: ["definicion","binPlot","Generators"], outputs: ["binplot_diferencia","bin_diferencia"], body: (definicion,binPlot,Generators) => {
const binplot_diferencia = definicion.baseline
  ? binPlot("diferencia", definicion.diferencia)
  : null;
const bin_diferencia = Generators.input(binplot_diferencia);
return {binplot_diferencia,bin_diferencia};
}});

define({id: "b6e70d63", inputs: ["municipio_actual","municipio_previo","municipio_diferencia"], outputs: ["municipio_integrado"], body: (municipio_actual,municipio_previo,municipio_diferencia) => {
const municipio_integrado =
  municipio_actual ?? municipio_previo ?? municipio_diferencia;
return {municipio_integrado};
}});

define({id: "e0450c11", inputs: ["definicion","leyenda_lineal","htl","municipio_seleccion"], outputs: ["draw_card"], body: (definicion,leyenda_lineal,htl,municipio_seleccion) => {
function draw_card(
  titulo,
  subtitulo,
  color_definicion,
  mapa,
  municipio,
  tipo,
  binplot,
  bin
) {
  if (definicion.disponibles.includes(tipo)) {
    const leyenda = leyenda_lineal(color_definicion, definicion.format);
    return htl.html`<estado>
    <titulo>${titulo}</titulo>
    <subtitulo>${subtitulo}</subtitulo>
    ${binplot}
    <mapa>
      ${mapa}
      ${municipio_seleccion(municipio, tipo)}
    </mapa>
  </estado>`;
  } else {
    return htl.html`<div></div>`;
  }
}
return {draw_card};
}});

define({id: "d1275129", inputs: ["definicion","htl"], outputs: ["disclaimer"], body: (definicion,htl) => {
const disclaimer = definicion.disponibles.includes(2012)
  ? htl.html`<div></div>`
  : htl.html`<disclaimer>( Sin datos para 2012 )</disclaimer>`;
return {disclaimer};
}});

define({id: "8c84a110", inputs: ["bins","indicador","colors","Plot"], outputs: ["binPlot"], body: (bins,indicador,colors,Plot) => {
function binPlot(tipo, color_definicion) {
  const x_domain = bins[indicador][tipo].extent;
  const inset = (x_domain[1] - x_domain[0]) / 100;
  const rectParams = {
    x1: "x0",
    x2: "x1",
    y: "count",
    fillOpacity: 0.5,
    fill: "x0",
    stroke: colors.background,
    mixBlendMode: "multiply",
    insetLeft: inset,
    insetRight: inset,
  };
  const axisParams = {
    tickSize: 0,
    label: null,
  };

  return Plot.plot({
    marginTop: 40,
    marginLeft: 10,
    marginRight: 10,
    marginBottom: 20,
    height: 120,
    width: 260,
    style: {
      color: colors.mid,
    },
    x: {
      ...axisParams,
      ticks: 5,
      domain: x_domain,
    },
    y: {
      ...axisParams,
      axis: "right",
      domain: [0, bins[indicador].max_count],
    },
    color: {
      interpolate: "hcl",
      ...color_definicion,
    },
    marks: [
      Plot.rectY(bins[indicador][tipo].bins, {
        ...rectParams,
      }),
      Plot.rectY(
        bins[indicador][tipo].bins,
        Plot.pointerX({
          ...rectParams,
          fillOpacity: 0.9,
        })
      ),
      Plot.text(
        bins[indicador][tipo].bins,
        Plot.pointerX({
          px: "mid",
          frameAnchor: "top",
          text: (d) => `${d.count} municipios\nentre ${d.x0} y ${d.x1}`,
          dy: -30,
          lineHeight: 1.2,
        })
      ),
      Plot.ruleY([0], {
        strokeWidth: 0.5,
      }),
    ],
  });
}
return {binPlot};
}});

define({id: "ff13d4c3", mode: "inline", inputs: ["indicador_input","display"], body: async (indicador_input,display) => {
display(await(
indicador_input
))
}});

define({id: "a514b67d", mode: "inline", inputs: ["definicion","display"], body: async (definicion,display) => {
display(await(
definicion.abreviacion
))
}});

define({id: "9b2015d1", mode: "inline", inputs: ["definicion","display"], body: async (definicion,display) => {
display(await(
definicion.texto
))
}});

define({id: "eb2b2a1d", mode: "inline", inputs: ["draw_card","definicion","mapa_actual","municipio_integrado","binplot_actual","display"], body: async (draw_card,definicion,mapa_actual,municipio_integrado,binplot_actual,display) => {
display(await(
draw_card("en 2024", "con datos del Censo 2024", definicion.estado, mapa_actual, municipio_integrado, 2024, binplot_actual)
))
}});

define({id: "8dbaee82", mode: "inline", inputs: ["draw_card","definicion","mapa_previo","municipio_integrado","binplot_previo","display"], body: async (draw_card,definicion,mapa_previo,municipio_integrado,binplot_previo,display) => {
display(await(
draw_card("en 2012", "con datos del Censo 2012", definicion.estado, mapa_previo, municipio_integrado, 2012, binplot_previo)
))
}});

define({id: "c710d75c", mode: "inline", inputs: ["draw_card","definicion","mapa_diferencia","municipio_integrado","binplot_diferencia","display"], body: async (draw_card,definicion,mapa_diferencia,municipio_integrado,binplot_diferencia,display) => {
display(await(
draw_card("cambios desde 2012", "2024 - 2012", definicion.diferencia, mapa_diferencia, municipio_integrado, "diferencia", binplot_diferencia)
))
}});

define({id: "c9479b65", mode: "inline", inputs: ["disclaimer","display"], body: async (disclaimer,display) => {
display(await(
disclaimer
))
}});

</script>
</head>
<body>
<div id="observablehq-center">
<main id="observablehq-main" class="observablehq">
<link rel="stylesheet" type="text/css" href="./_file/index.581f9ab6.css">
<div class="observablehq observablehq--block"><!--:eecc0d5c:--></div>
<div class="observablehq observablehq--block"><!--:cb634678:--></div>
<div class="observablehq observablehq--block"><!--:06b7a24d:--></div>
<div class="observablehq observablehq--block"><!--:4fc3cdab:--></div>
<div class="observablehq observablehq--block"><!--:246b763d:--></div>
<div class="observablehq observablehq--block"><!--:04e18386:--></div>
<div class="observablehq observablehq--block"><!--:20fa5508:--></div>
<div class="observablehq observablehq--block"><!--:3930c542:--></div>
<div class="observablehq observablehq--block"><!--:899678b8:--></div>
<div class="observablehq observablehq--block"><!--:8b6ac28a:--></div>
<div class="observablehq observablehq--block"><!--:8d37328f:--></div>
<div class="observablehq observablehq--block"><!--:443ad38c:--></div>
<div class="observablehq observablehq--block"><!--:154cd381:--></div>
<div class="observablehq observablehq--block"><!--:d9f9a22c:--></div>
<div class="observablehq observablehq--block"><!--:e3283b37:--></div>
<div class="observablehq observablehq--block"><!--:34d3a4f7:--></div>
<div class="observablehq observablehq--block"><!--:b6e70d63:--></div>
<div class="observablehq observablehq--block"><!--:e0450c11:--></div>
<div class="observablehq observablehq--block"><!--:d1275129:--></div>
<div class="observablehq observablehq--block"><!--:8c84a110:--></div>
<menu>
  <titulo>Indicadores de desarrollo basados en el Censo 2024</titulo>
  <observablehq-loading></observablehq-loading><!--:ff13d4c3:-->
</menu>
<cuerpo>
  <contenido>
    <header>
      <titulo><observablehq-loading></observablehq-loading><!--:a514b67d:--></titulo>
      <subtitulo><observablehq-loading></observablehq-loading><!--:9b2015d1:--></subtitulo>
    </header>
    <cards>
      <card>
      <observablehq-loading></observablehq-loading><!--:eb2b2a1d:-->
      </card>
      <card>
      <observablehq-loading></observablehq-loading><!--:8dbaee82:-->
      </card>
      <card>
      <observablehq-loading></observablehq-loading><!--:c710d75c:-->
      </card>
    </cards>
    <observablehq-loading></observablehq-loading><!--:c9479b65:-->
  </contenido>
</cuerpo>
<footer>
  <fuente>
  Estimaciones del <a href="https://fichas.ine.gob.bo/#/web/ods-cpv" target="_blank" rel="noopener noreferrer">Instituto Nacional de Estadística</a>, <a href="https://github.com/mauforonda/ods-cpv" target="_blank" rel="noopener noreferrer">descargadas y visualizadas</a> por <a href="https://mauforonda.github.io/" target="_blank" rel="noopener noreferrer">Mauricio Foronda</a>
  </fuente>
</footer>
</main>
</div>
</body>
</html>
